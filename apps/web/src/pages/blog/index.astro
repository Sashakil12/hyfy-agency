---
import '../../styles/global.css';
import type { BlogPost, Category } from '../../lib/strapi';
import { getBlogPosts, getCategories } from '../../lib/strapi';
import BlogCard from '../../components/blog/BlogCard.astro';
import Pagination from '../../components/blog/Pagination.astro';
import GlobalHeader from '../../components/GlobalHeader';

export const prerender = false; // Enable SSR for this page

const currentPage = Number(Astro.url.searchParams.get('page') || 1);
const categorySlug = Astro.url.searchParams.get('category') || undefined;
const pageSize = 9;

let blogPosts: BlogPost[] = [];
let categories: Category[] = [];
let pagination = {
  page: 1,
  pageSize: 9,
  pageCount: 1,
  total: 0,
};

try {
  const response = await getBlogPosts(currentPage, pageSize, categorySlug);
  blogPosts = response.data;
  pagination = response.meta.pagination;
  categories = await getCategories();
} catch (error) {
  console.error('Error fetching blog posts:', error);
}

const selectedCategory = categories.find(cat => cat.slug === categorySlug);
const title = selectedCategory
  ? `${selectedCategory.name} Articles | HyFy Blog`
  : 'HyFy Blog | Latest Insights';
const description = selectedCategory
  ? `Explore our latest articles about ${selectedCategory.name}.`
  : 'Expert insights on Custom ERPs, AI-Native Apps, SaaS Development, and Workflow Automation.';
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url.href} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={Astro.url.href} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&family=Inter+Tight:wght@400;500;600;700;800;900&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Canonical URL -->
    <link rel="canonical" href={Astro.url.pathname} />

    <!-- Structured Data -->
    <script is:inline type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Blog",
      "name": "HyFy Blog",
      "description": description,
      "url": Astro.url.href,
      "publisher": {
        "@type": "Organization",
        "name": "HyFy"
      }
    })} />
  </head>
  <body class="bg-obsidian text-white font-exo overflow-x-hidden">
    <!-- Global Header -->
    <GlobalHeader client:load currentPath={Astro.url.pathname} />

    <!-- Animated Background Grid -->
    <div class="fixed inset-0 pointer-events-none opacity-20">
      <div class="absolute inset-0"
           style="background-image: linear-gradient(#88FF66 1px, transparent 1px), linear-gradient(90deg, #88FF66 1px, transparent 1px); background-size: 50px 50px; opacity: 0.05;">
      </div>
    </div>

    <!-- Hero Section with Enhanced Parallax -->
    <section class="relative min-h-[80vh] flex items-center justify-center overflow-hidden pt-20">
      <!-- Animated Background Gradient Orbs -->
      <div class="absolute inset-0 pointer-events-none overflow-hidden">
        <!-- Primary Glow -->
        <div class="absolute top-1/4 left-1/4 w-[500px] h-[500px] bg-lime/20 rounded-full blur-[120px]
                    animate-float" style="animation-delay: 0s;"></div>
        <!-- Secondary Glow -->
        <div class="absolute bottom-1/4 right-1/4 w-[400px] h-[400px] bg-amber/15 rounded-full blur-[100px]
                    animate-float" style="animation-delay: 2s;"></div>
        <!-- Tertiary Glow -->
        <div class="absolute top-1/2 right-1/3 w-[300px] h-[300px] bg-lime/10 rounded-full blur-[80px]
                    animate-float" style="animation-delay: 4s;"></div>
      </div>

      <!-- Geometric Floating Elements -->
      <div class="absolute inset-0 pointer-events-none">
        <!-- Floating Box 1 -->
        <div class="absolute top-[20%] left-[10%] w-20 h-20 border border-lime/20 rounded-xl
                    animate-float-slow backdrop-blur-sm bg-white/[0.02]"
             style="animation-delay: 1s; transform: rotate(45deg);"></div>
        <!-- Floating Box 2 -->
        <div class="absolute top-[60%] right-[15%] w-16 h-16 border border-lime/15 rounded-lg
                    animate-float-slow backdrop-blur-sm bg-white/[0.02]"
             style="animation-delay: 3s; transform: rotate(-30deg);"></div>
        <!-- Floating Box 3 -->
        <div class="absolute bottom-[25%] left-[20%] w-12 h-12 border border-lime/10 rounded-md
                    animate-float-slow backdrop-blur-sm bg-white/[0.02]"
             style="animation-delay: 5s; transform: rotate(15deg);"></div>
      </div>

      <!-- Background Text (Watermark) with Gradient -->
      <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
        <h1 class="font-orbitron font-bold text-[20vw] md:text-[15vw] lg:text-[12vw] uppercase tracking-[0.05em] select-none"
            style="background: linear-gradient(180deg, rgba(255,255,255,0.05) 0%, rgba(136,255,102,0.03) 50%, rgba(255,255,255,0.01) 100%);
                   -webkit-background-clip: text;
                   -webkit-text-fill-color: transparent;
                   background-clip: text;"
            data-parallax="0.2">
          Insights
        </h1>
      </div>

      <!-- Hero Content -->
      <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center pt-32 pb-20">
        <!-- Top Badge with Pulse Animation -->
        <div class="inline-block mb-8 animate-fade-in-down">
          <div class="relative px-8 py-3 rounded-full bg-white/[0.05] backdrop-blur-xl border border-lime/30
                      shadow-[0_0_30px_rgba(136,255,102,0.25)] hover:shadow-[0_0_40px_rgba(136,255,102,0.4)]
                      transition-all duration-300 group">
            <!-- Pulse Effect -->
            <div class="absolute inset-0 rounded-full border border-lime/30 animate-ping opacity-20"></div>
            <div class="relative flex items-center gap-2">
              <div class="w-2 h-2 rounded-full bg-lime animate-pulse shadow-[0_0_10px_rgba(136,255,102,0.8)]"></div>
              <span class="text-lime text-sm font-semibold tracking-widest uppercase">Latest Insights</span>
            </div>
          </div>
        </div>

        <!-- Main Title with Stagger Animation -->
        <div class="mb-8 animate-fade-in" style="animation-delay: 0.2s;">
          <h2 class="font-orbitron font-bold text-6xl md:text-7xl lg:text-8xl mb-4 uppercase tracking-wide leading-none">
            <span class="inline-block text-white">
              HyFy
            </span>
            <br />
            <span class="inline-block relative">
              <span class="text-lime relative z-10"
                    style="text-shadow: 0 0 30px rgba(136, 255, 102, 0.6), 0 0 60px rgba(136, 255, 102, 0.3);">
                Blog
              </span>
              <!-- Underline Accent -->
              <div class="absolute -bottom-2 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-lime to-transparent
                          opacity-50 blur-sm"></div>
            </span>
          </h2>
        </div>

        <!-- Description with Glass Panel -->
        <div class="animate-fade-in" style="animation-delay: 0.4s;">
          <div class="inline-block max-w-3xl mx-auto">
            <div class="relative p-6 rounded-2xl bg-white/[0.03] backdrop-blur-xl border border-white/10
                        shadow-[0_8px_32px_rgba(0,0,0,0.3)]">
              <p class="text-luminous text-lg md:text-xl leading-relaxed">
                Expert insights on
                <span class="text-lime font-semibold">Custom ERPs</span>,
                <span class="text-lime font-semibold">AI-Native Apps</span>,
                <span class="text-lime font-semibold">SaaS Development</span>,
                and <span class="text-lime font-semibold">Workflow Automation</span>
              </p>
            </div>
          </div>
        </div>

        <!-- Call-to-Action Scroll Indicator -->
        <div class="mt-12 animate-fade-in" style="animation-delay: 0.6s;">
          <div class="inline-flex flex-col items-center gap-2 text-luminous-tertiary hover:text-lime
                      transition-colors duration-300 cursor-pointer group"
               onclick="window.scrollTo({ top: window.innerHeight * 0.8, behavior: 'smooth' })">
            <span class="text-sm font-medium uppercase tracking-wider">Scroll to Explore</span>
            <div class="w-6 h-10 rounded-full border-2 border-lime/30 flex items-start justify-center p-2
                        group-hover:border-lime/50 transition-colors duration-300">
              <div class="w-1.5 h-1.5 rounded-full bg-lime animate-scroll-down"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Gradient Fade -->
      <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-obsidian to-transparent pointer-events-none"></div>
    </section>

    <!-- Category Filter -->
    <section id="blog-filter" class="relative py-8 border-b border-white/5 scroll-mt-24">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col md:flex-row items-start md:items-center gap-6">
          <!-- Filter Label -->
          <div class="flex items-center gap-3">
            <svg class="w-5 h-5 text-lime" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
            </svg>
            <span class="font-semibold text-white uppercase tracking-wider text-sm">Filter by:</span>
          </div>

          <!-- Category Pills -->
          <div class="flex flex-wrap items-center gap-3">
            <!-- All Categories -->
            <a
              href="/blog"
              class:list={[
                "px-5 py-2.5 rounded-full text-sm font-semibold uppercase tracking-wider transition-all duration-300",
                "border-2 backdrop-blur-xl",
                !categorySlug
                  ? "bg-lime/20 border-lime text-lime shadow-[0_0_20px_rgba(136,255,102,0.3)]"
                  : "bg-white/[0.03] border-white/20 text-white hover:border-lime/50 hover:text-lime hover:bg-lime/5"
              ]}
            >
              All Articles
            </a>

            <!-- First 3 Categories -->
            {categories.slice(0, 3).map((category) => (
              <div
                class:list={[
                  "inline-flex items-center gap-2 pl-5 pr-3 py-2.5 rounded-full transition-all duration-300",
                  "border-2 backdrop-blur-xl",
                  categorySlug === category.slug
                    ? "bg-lime/20 border-lime text-lime shadow-[0_0_20px_rgba(136,255,102,0.3)]"
                    : "bg-white/[0.03] border-white/20 text-white hover:border-lime/50 hover:text-lime hover:bg-lime/5 hover:scale-105"
                ]}
              >
                <a
                  href={`/blog?category=${category.slug}`}
                  class="text-sm font-semibold uppercase tracking-wider"
                >
                  {category.name}
                </a>
                <!-- Open in new tab icon -->
                <a
                  href={`/blog/categories/${category.slug}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="flex items-center justify-center text-luminous-tertiary hover:text-lime
                         transition-colors duration-200"
                  aria-label={`Open ${category.name} in new tab`}
                  title={`View all ${category.name} articles in new tab`}
                >
                  <svg class="w-2.5 h-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </a>
              </div>
            ))}

            <!-- More Categories Dropdown -->
            {categories.length > 3 && (
              <div class="relative" id="category-dropdown">
                <button
                  id="category-more-btn"
                  type="button"
                  class="px-5 py-2.5 rounded-full text-sm font-semibold uppercase tracking-wider transition-all duration-300
                         border-2 backdrop-blur-xl bg-white/[0.03] border-white/20 text-white
                         hover:border-lime/50 hover:text-lime hover:bg-lime/5
                         flex items-center gap-2"
                  aria-expanded="false"
                  aria-haspopup="true"
                >
                  <span>More</span>
                  <svg class="w-4 h-4 transition-transform duration-200" id="dropdown-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>

                <!-- Dropdown Menu -->
                <div
                  id="category-menu"
                  class="absolute top-full mt-2 left-0 min-w-[200px] rounded-xl
                         bg-charcoal/95 backdrop-blur-xl border border-white/20
                         shadow-[0_8px_32px_rgba(0,0,0,0.5)]
                         opacity-0 invisible transition-all duration-200 z-50"
                  role="menu"
                  aria-orientation="vertical"
                >
                  <div class="py-2">
                    {categories.slice(3).map((category, index) => (
                      <div class="flex items-center justify-between gap-3 px-5 py-3 hover:bg-white/[0.05] transition-all duration-200 group">
                        <a
                          href={`/blog?category=${category.slug}`}
                          class="flex-1 text-sm font-semibold uppercase tracking-wider text-white
                                 hover:text-lime transition-colors duration-200"
                          role="menuitem"
                        >
                          {category.name}
                          {categorySlug === category.slug && (
                            <span class="ml-2 inline-block w-1.5 h-1.5 rounded-full bg-lime"></span>
                          )}
                        </a>
                        <!-- Open in new tab icon -->
                        <a
                          href={`/blog/categories/${category.slug}`}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="flex items-center justify-center text-luminous-tertiary
                                 opacity-0 group-hover:opacity-100
                                 hover:text-lime transition-all duration-200"
                          aria-label={`Open ${category.name} in new tab`}
                          title={`View all ${category.name} articles in new tab`}
                          onclick="event.stopPropagation()"
                        >
                          <svg class="w-2.5 h-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                          </svg>
                        </a>
                      </div>
                    ))}

                    <!-- Browse All Categories Link -->
                    <div class="mt-2 pt-2 border-t border-white/10">
                      <a
                        href="/blog/categories"
                        class="flex items-center justify-between gap-3 px-5 py-3 hover:bg-lime/10 rounded-lg
                               transition-all duration-200 group mx-2"
                        role="menuitem"
                      >
                        <div class="flex items-center gap-2">
                          <svg class="w-4 h-4 text-lime" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                          </svg>
                          <span class="text-sm font-semibold uppercase tracking-wider text-lime">
                            Browse All Categories
                          </span>
                        </div>
                        <svg class="w-4 h-4 text-lime group-hover:translate-x-1 transition-transform duration-200"
                             fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>

          <!-- Results Count -->
          {categorySlug && (
            <div class="ml-auto flex items-center gap-2 px-4 py-2 rounded-full bg-white/[0.03] border border-white/10">
              <span class="text-luminous-tertiary text-sm">
                {pagination.total} {pagination.total === 1 ? 'article' : 'articles'}
              </span>
            </div>
          )}
        </div>
      </div>
    </section>

    <!-- Blog Posts Grid -->
    <section class="relative py-20">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {blogPosts.length === 0 ? (
          <!-- Empty State -->
          <div class="text-center py-20">
            <div class="inline-block p-6 rounded-2xl bg-white/[0.03] backdrop-blur-md border border-white/10">
              <svg class="w-16 h-16 mx-auto mb-4 text-lime/50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
              </svg>
              <h3 class="font-orbitron text-2xl font-semibold mb-2">No Posts Yet</h3>
              <p class="text-luminous-tertiary">Check back soon for new content</p>
            </div>
          </div>
        ) : (
          <>
            <!-- Bento Grid Layout -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8"
                 data-stagger-animation>
              {blogPosts.map((post, index) => (
                <BlogCard post={post} index={index} />
              ))}
            </div>

            <!-- Pagination -->
            {pagination.pageCount > 1 && (
              <div class="mt-16">
                <Pagination
                  currentPage={pagination.page}
                  totalPages={pagination.pageCount}
                  basePath="/blog"
                  categorySlug={categorySlug}
                />
              </div>
            )}
          </>
        )}
      </div>
    </section>

    <!-- CTA Section -->
    <section class="relative py-20">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <div class="relative p-12 rounded-3xl bg-white/[0.03] backdrop-blur-2xl border border-white/10
                    shadow-[0_0_30px_rgba(136,255,102,0.1)] overflow-hidden">
          <!-- Background Glow -->
          <div class="absolute -top-20 -right-20 w-40 h-40 bg-lime/20 rounded-full blur-[80px]"></div>
          <div class="absolute -bottom-20 -left-20 w-40 h-40 bg-amber/20 rounded-full blur-[80px]"></div>

          <div class="relative z-10">
            <h3 class="font-orbitron font-bold text-3xl md:text-4xl mb-4 uppercase">
              Stay <span class="text-lime">Connected</span>
            </h3>
            <p class="text-luminous-tertiary text-lg mb-8 max-w-2xl mx-auto">
              Subscribe to get the latest articles delivered to your inbox
            </p>
            <form id="newsletter-form" class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto">
              <input
                type="email"
                id="newsletter-email"
                name="email"
                placeholder="your@email.com"
                class="flex-1 px-6 py-4 rounded-xl bg-white/[0.05] backdrop-blur-md border border-white/10
                       text-white placeholder-luminous-tertiary focus:outline-none focus:border-lime/50
                       focus:shadow-[0_0_15px_rgba(136,255,102,0.2)] transition-all duration-200"
                required
              />
              <button
                type="submit"
                id="newsletter-submit"
                class="px-8 py-4 rounded-xl bg-lime text-obsidian font-semibold uppercase tracking-wide
                       hover:bg-lime/90 transition-all duration-200 cursor-pointer
                       shadow-[0_0_20px_rgba(136,255,102,0.4)] hover:shadow-[0_0_30px_rgba(136,255,102,0.6)]
                       disabled:opacity-50 disabled:cursor-not-allowed">
                <span id="submit-text">Subscribe</span>
                <span id="submit-loading" class="hidden">Subscribing...</span>
              </button>
            </form>
            <!-- Success/Error Message -->
            <div id="newsletter-message" class="mt-6 hidden">
              <p id="message-text" class="text-sm font-medium"></p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <style>
      @font-face {
        font-family: 'Exo 2';
        font-display: swap;
      }

      @font-face {
        font-family: 'Orbitron';
        font-display: swap;
      }

      .font-exo {
        font-family: 'Exo 2', sans-serif;
      }

      .font-orbitron {
        font-family: 'Orbitron', sans-serif;
      }

      /* Floating Animation */
      @keyframes float {
        0%, 100% {
          transform: translateY(0px) translateX(0px);
        }
        25% {
          transform: translateY(-20px) translateX(10px);
        }
        50% {
          transform: translateY(-10px) translateX(-10px);
        }
        75% {
          transform: translateY(-15px) translateX(5px);
        }
      }

      .animate-float {
        animation: float 8s ease-in-out infinite;
      }

      .animate-float-slow {
        animation: float 12s ease-in-out infinite;
      }

      /* Fade In Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-fade-in {
        animation: fadeIn 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        opacity: 0;
      }

      .animate-fade-in-down {
        animation: fadeInDown 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        opacity: 0;
      }

      /* Scroll Down Indicator */
      @keyframes scrollDown {
        0% {
          opacity: 1;
          transform: translateY(0);
        }
        50% {
          opacity: 0.5;
          transform: translateY(8px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-scroll-down {
        animation: scrollDown 2s ease-in-out infinite;
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>

    <script>
      // Parallax effect for hero text
      const parallaxElements = document.querySelectorAll<HTMLElement>('[data-parallax]');

      window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;

        parallaxElements.forEach((el) => {
          const speed = parseFloat(el.getAttribute('data-parallax') || '0.5');
          const yPos = -(scrolled * speed);
          el.style.transform = `translateY(${yPos}px)`;
        });
      });

      // Stagger animation for blog cards
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const cards = entry.target.children;
            Array.from(cards).forEach((card, index) => {
              setTimeout(() => {
                card.classList.add('animate-fade-in-up');
              }, index * 100);
            });
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1 });

      const staggerContainer = document.querySelector('[data-stagger-animation]');
      if (staggerContainer) {
        observer.observe(staggerContainer);
      }

      // Add animation class
      const style = document.createElement('style');
      style.textContent = `
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .animate-fade-in-up {
          animation: fadeInUp 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }
      `;
      document.head.appendChild(style);

      // Newsletter subscription
      const newsletterForm = document.getElementById('newsletter-form') as HTMLFormElement;
      const emailInput = document.getElementById('newsletter-email') as HTMLInputElement;
      const submitButton = document.getElementById('newsletter-submit') as HTMLButtonElement;
      const submitText = document.getElementById('submit-text') as HTMLSpanElement;
      const submitLoading = document.getElementById('submit-loading') as HTMLSpanElement;
      const messageDiv = document.getElementById('newsletter-message') as HTMLDivElement;
      const messageText = document.getElementById('message-text') as HTMLParagraphElement;

      newsletterForm?.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = emailInput.value.trim();
        if (!email) return;

        // Show loading state
        submitButton.disabled = true;
        submitText.classList.add('hidden');
        submitLoading.classList.remove('hidden');
        messageDiv.classList.add('hidden');

        try {
          const strapiUrl = import.meta.env.STRAPI_URL || 'http://localhost:1337';
          const response = await fetch(`${strapiUrl}/api/newsletter-subscribe`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email }),
          });

          const data = await response.json();

          // Show message
          messageDiv.classList.remove('hidden');
          messageText.textContent = data.message || 'Thank you for subscribing!';

          if (response.ok) {
            messageText.className = 'text-sm font-medium text-lime';
            emailInput.value = '';
          } else {
            messageText.className = 'text-sm font-medium text-amber';
          }
        } catch (error) {
          console.error('Subscription error:', error);
          messageDiv.classList.remove('hidden');
          messageText.textContent = 'Something went wrong. Please try again later.';
          messageText.className = 'text-sm font-medium text-amber';
        } finally {
          // Reset button state
          submitButton.disabled = false;
          submitText.classList.remove('hidden');
          submitLoading.classList.add('hidden');
        }
      });

      // Scroll to filter section when category/page changes
      const urlParams = new URLSearchParams(window.location.search);
      const hasCategory = urlParams.has('category');
      const hasPage = urlParams.has('page');

      if (hasCategory || hasPage) {
        // Wait for page to fully load
        window.addEventListener('load', () => {
          const filterSection = document.getElementById('blog-filter');
          if (filterSection) {
            setTimeout(() => {
              filterSection.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }, 100);
          }
        });
      }

      // Category dropdown toggle
      const categoryBtn = document.getElementById('category-more-btn');
      const categoryMenu = document.getElementById('category-menu');
      const dropdownIcon = document.getElementById('dropdown-icon');

      if (categoryBtn && categoryMenu) {
        categoryBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          const isOpen = categoryBtn.getAttribute('aria-expanded') === 'true';

          if (isOpen) {
            // Close dropdown
            categoryMenu.classList.remove('opacity-100', 'visible');
            categoryMenu.classList.add('opacity-0', 'invisible');
            categoryBtn.setAttribute('aria-expanded', 'false');
            dropdownIcon?.classList.remove('rotate-180');
          } else {
            // Open dropdown
            categoryMenu.classList.remove('opacity-0', 'invisible');
            categoryMenu.classList.add('opacity-100', 'visible');
            categoryBtn.setAttribute('aria-expanded', 'true');
            dropdownIcon?.classList.add('rotate-180');
          }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
          if (categoryBtn.getAttribute('aria-expanded') === 'true') {
            categoryMenu.classList.remove('opacity-100', 'visible');
            categoryMenu.classList.add('opacity-0', 'invisible');
            categoryBtn.setAttribute('aria-expanded', 'false');
            dropdownIcon?.classList.remove('rotate-180');
          }
        });
      }
    </script>
  </body>
</html>
