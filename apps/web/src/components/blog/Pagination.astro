---
interface Props {
  currentPage: number;
  totalPages: number;
  basePath: string;
  categorySlug?: string;
}

const { currentPage, totalPages, basePath, categorySlug } = Astro.props;

const getPageUrl = (page: number) => {
  const params = new URLSearchParams();

  if (categorySlug) {
    params.set('category', categorySlug);
  }

  if (page > 1) {
    params.set('page', page.toString());
  }

  const queryString = params.toString();
  return queryString ? `${basePath}?${queryString}` : basePath;
};

// Generate page numbers with ellipsis
const getPageNumbers = () => {
  const pages: (number | string)[] = [];
  const maxVisible = 5;

  if (totalPages <= maxVisible) {
    // Show all pages if total is small
    for (let i = 1; i <= totalPages; i++) {
      pages.push(i);
    }
  } else {
    // Always show first page
    pages.push(1);

    if (currentPage > 3) {
      pages.push('...');
    }

    // Show current page and neighbors
    const start = Math.max(2, currentPage - 1);
    const end = Math.min(totalPages - 1, currentPage + 1);

    for (let i = start; i <= end; i++) {
      pages.push(i);
    }

    if (currentPage < totalPages - 2) {
      pages.push('...');
    }

    // Always show last page
    pages.push(totalPages);
  }

  return pages;
};

const pageNumbers = getPageNumbers();
const hasPrevious = currentPage > 1;
const hasNext = currentPage < totalPages;
---

<nav aria-label="Blog pagination" class="flex justify-center">
  <div class="inline-flex items-center gap-2 p-2 rounded-2xl bg-white/[0.03] backdrop-blur-md border border-white/10">
    <!-- Previous Button -->
    {hasPrevious ? (
      <a
        href={getPageUrl(currentPage - 1)}
        class="flex items-center justify-center w-10 h-10 rounded-xl
               bg-white/[0.05] border border-white/10 text-lime
               hover:bg-lime/10 hover:border-lime/30 hover:shadow-[0_0_15px_rgba(136,255,102,0.2)]
               transition-all duration-200 cursor-pointer"
        aria-label="Previous page"
      >
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </a>
    ) : (
      <button
        disabled
        class="flex items-center justify-center w-10 h-10 rounded-xl
               bg-white/[0.02] border border-white/5 text-luminous-tertiary/50 cursor-not-allowed"
        aria-label="Previous page (disabled)"
      >
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
    )}

    <!-- Page Numbers -->
    <div class="flex items-center gap-1">
      {pageNumbers.map((page) => (
        page === '...' ? (
          <span class="px-3 py-2 text-luminous-tertiary">...</span>
        ) : page === currentPage ? (
          <span
            class="flex items-center justify-center min-w-[2.5rem] h-10 px-4 rounded-xl
                   bg-lime text-obsidian font-semibold font-orbitron
                   shadow-[0_0_20px_rgba(136,255,102,0.4)]"
            aria-current="page"
            aria-label={`Page ${page} (current)`}
          >
            {page}
          </span>
        ) : (
          <a
            href={getPageUrl(page as number)}
            class="flex items-center justify-center min-w-[2.5rem] h-10 px-4 rounded-xl
                   bg-white/[0.05] border border-white/10 text-white font-orbitron
                   hover:bg-lime/10 hover:border-lime/30 hover:text-lime
                   hover:shadow-[0_0_15px_rgba(136,255,102,0.2)]
                   transition-all duration-200 cursor-pointer"
            aria-label={`Go to page ${page}`}
          >
            {page}
          </a>
        )
      ))}
    </div>

    <!-- Next Button -->
    {hasNext ? (
      <a
        href={getPageUrl(currentPage + 1)}
        class="flex items-center justify-center w-10 h-10 rounded-xl
               bg-white/[0.05] border border-white/10 text-lime
               hover:bg-lime/10 hover:border-lime/30 hover:shadow-[0_0_15px_rgba(136,255,102,0.2)]
               transition-all duration-200 cursor-pointer"
        aria-label="Next page"
      >
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    ) : (
      <button
        disabled
        class="flex items-center justify-center w-10 h-10 rounded-xl
               bg-white/[0.02] border border-white/5 text-luminous-tertiary/50 cursor-not-allowed"
        aria-label="Next page (disabled)"
      >
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    )}
  </div>
</nav>

<style>
  .font-orbitron {
    font-family: 'Orbitron', sans-serif;
  }

  @media (prefers-reduced-motion: reduce) {
    * {
      transition-duration: 0.01ms !important;
    }
  }
</style>
